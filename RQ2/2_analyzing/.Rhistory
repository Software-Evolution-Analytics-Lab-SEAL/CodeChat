library(extrafont)
font_import()   # First time only, takes time
loadfonts(device = "pdf")
install.packages("extrafont")
library(extrafont)
font_import()    # Only run once; can take several minutes
loadfonts(device = "pdf")
x11(width = 12, height = 8)
print(gg)
cat("✅ Plot rendered — window stays until closed manually\n")
Sys.sleep(600)  # Keeps window for 10 minutes, adjust as needed
library(ggplot2)
library(dplyr)
# Load data
df <- read.csv('../../rq2_results/1_fullturn/2_analyzing/0_8_turn_counts_final_ids.csv')
df$final_cluster_id <- as.numeric(as.character(df$final_cluster_id))
df$turns <- as.numeric(as.character(df$turns))
df_top <- subset(df, final_cluster_id >= 0 & final_cluster_id <= 9)
df_top$display_cluster <- paste("Topic", df_top$final_cluster_id + 1)
df_top$display_cluster <- factor(df_top$display_cluster)
cluster_stats <- df_top %>%
  group_by(display_cluster) %>%
  summarise(p75 = quantile(turns, 0.75)) %>%
  arrange(desc(p75))
df_top$display_cluster <- factor(df_top$display_cluster, levels = cluster_stats$display_cluster)
gg <- ggplot(df_top, aes(x = display_cluster, y = turns, fill = display_cluster)) +
  geom_violin(trim = FALSE, alpha = 0.5) +
  geom_boxplot(width = 0.1, outlier.shape = NA, fill = "white") +
  scale_y_continuous(trans = "log10", breaks = c(1, 2, 5, 10, 20, 50, 100)) +
  labs(x = "Topic ID", y = "Turn Count per Conversation") +
  theme_minimal() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12, face = "bold"),
    axis.text.y = element_text(size = 12, face = "bold"),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    panel.background = element_rect(fill = "white"),
    plot.background = element_rect(fill = "white")
  )
x11(width = 12, height = 8)
print(gg)
Sys.sleep(600)  # Window stays open for 10 minutes
remove.packages("ScottKnottESD")
install.packages("ScottKnottESD", dependencies = TRUE)

.rs.restartR()   # If in RStudio

